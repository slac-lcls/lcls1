

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Configuration Data &mdash; PyDataSource 0.6.9 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="PyDataSource 0.6.9 documentation" href="index.html"/>
        <link rel="next" title="PyDataSource.config_check.ConfigCheck" href="generated/PyDataSource.config_check.ConfigCheck.html"/>
        <link rel="prev" title="PyDataSource.to_summary" href="generated/PyDataSource.to_summary.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> PyDataSource
          

          
          </a>

          
            
            
              <div class="version">
                0.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="data_access.html">Data Access Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_processing.html">Data Processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="xarray.html">Data Structures</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_summary.html">Summarizing Data</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Configuration Data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#detector-timing-and-config-check">Detector Timing and Config Check</a><ul>
<li class="toctree-l3"><a class="reference internal" href="generated/PyDataSource.config_check.ConfigCheck.html">PyDataSource.config_check.ConfigCheck</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#configdata-class-api">ConfigData Class API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="generated/PyDataSource.ConfigData.html">PyDataSource.ConfigData</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#attributes">Attributes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="generated/PyDataSource.ConfigData.Sources.html">PyDataSource.ConfigData.Sources</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/PyDataSource.ConfigData.ScanData.html">PyDataSource.ConfigData.ScanData</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="meta_data.html">Meta Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="apps.html">Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="build_html.html">Run Summary Reports</a></li>
<li class="toctree-l1"><a class="reference internal" href="exp_summary.html">Experiment Summary</a></li>
<li class="toctree-l1"><a class="reference internal" href="offbyone.html">Off-by-one Timing Error Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="batch.html">Submitting Batch Jobs</a></li>
<li class="toctree-l1"><a class="reference internal" href="conda.html">Updating Releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">PyDatSource API</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">PyDataSource</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Configuration Data</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/config_data.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="configuration-data">
<span id="config-data"></span><h1>Configuration Data<a class="headerlink" href="#configuration-data" title="Permalink to this headline">¶</a></h1>
<p>Configuration data for each detector as well as for example daq control information is available
as configData.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [14]: </span><span class="n">ds</span><span class="o">.</span><span class="n">configData</span><span class="o">.</span><span class="n">ControlData</span><span class="o">.</span><span class="n">show_info</span><span class="p">()</span>
<span class="gh">Out[14]:</span>
<span class="go">duration                 seconds: 0 nano:0         Maximum duration of the scan.</span>
<span class="go">events                              0         Maximum number of events per scan.</span>
<span class="go">npvControls                         0         Number of PVControl objects in this configuration.</span>
<span class="go">npvLabels                           0         Number of PVLabel objects in this configuration.</span>
<span class="go">npvMonitors                         0         Number of PVMonitor objects in this configuration.</span>
<span class="go">pvControls                         []         PVControl configuration objects</span>
<span class="go">pvLabels                           []         PVLabel configuration objects</span>
<span class="go">pvMonitors                         []         PVMonitor configuration objects</span>
<span class="go">uses_duration                       0         returns true if the configuration uses duration control.</span>
<span class="go">uses_events                         1         returns true if the configuration uses events limit.</span>
<span class="go">uses_l3t_events                     0         returns true if the configuration uses l3trigger events limit.</span>

<span class="gp">In [15]: </span><span class="n">ds</span><span class="o">.</span><span class="n">configData</span><span class="o">.</span><span class="n">ScanData</span><span class="o">.</span><span class="n">show_info</span><span class="p">()</span>
<span class="gh">Out[15]:</span>
<span class="go">xpptut15  : Run 54</span>
<span class="gt">----------------------------------------------------------------------</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">steps</span>                   <span class="mi">1</span> <span class="n">nsteps</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">monitor</span> <span class="n">PVs</span>             <span class="mi">0</span> <span class="n">npvMonitors</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">control</span> <span class="n">PVs</span>             <span class="mi">0</span> <span class="n">npvControls</span>

<span class="n">Alias</span>                    <span class="n">PV</span>
<span class="gt">----------------------------------------------------------------------</span>

<span class="n">Step</span> <span class="n">Events</span>   <span class="n">Time</span> <span class="p">[</span><span class="n">s</span><span class="p">]</span>
<span class="gt">---------------------</span>
<span class="g g-Whitespace">   </span><span class="mi">0</span>   <span class="mi">1218</span>   <span class="mf">10.154</span>

<span class="gp">In [16]: </span><span class="n">ds</span><span class="o">.</span><span class="n">configData</span><span class="o">.</span><span class="n">Sources</span>
<span class="gh">Out[16]: </span><span class="go">&lt; ConfigSources: exp=xpptut15:run=54:smd &gt;</span>

<span class="gp">In [17]: </span><span class="n">ds</span><span class="o">.</span><span class="n">configData</span><span class="o">.</span><span class="n">Sources</span><span class="o">.</span><span class="n">show_info</span><span class="p">()</span>
<span class="gh">Out[17]:</span>
<span class="go">*Detectors in group 0 are &quot;BLD&quot; data recorded at 120 Hz on event code 40</span>
<span class="go">*Detectors listed as Controls are controls devices with unknown event code (but likely 40).</span>

<span class="go">Alias                     Group          Rate  Code  Pol. Delay [s]    Width [s]    Source</span>
<span class="gt">------------------------------------------------------------------------------------------------------------------------</span>
<span class="n">EBeam</span>                         <span class="mi">0</span>        <span class="mi">120</span> <span class="n">Hz</span>    <span class="mi">40</span>                                 <span class="n">BldInfo</span><span class="p">(</span><span class="n">EBeam</span><span class="p">)</span>
<span class="n">FEEGasDetEnergy</span>               <span class="mi">0</span>        <span class="mi">120</span> <span class="n">Hz</span>    <span class="mi">40</span>                                 <span class="n">BldInfo</span><span class="p">(</span><span class="n">FEEGasDetEnergy</span><span class="p">)</span>
<span class="n">PhaseCavity</span>                   <span class="mi">0</span>        <span class="mi">120</span> <span class="n">Hz</span>    <span class="mi">40</span>                                 <span class="n">BldInfo</span><span class="p">(</span><span class="n">PhaseCavity</span><span class="p">)</span>
<span class="n">XppEnds_Ipm0</span>                  <span class="mi">0</span>        <span class="mi">120</span> <span class="n">Hz</span>    <span class="mi">40</span>                                 <span class="n">BldInfo</span><span class="p">(</span><span class="n">XppEnds_Ipm0</span><span class="p">)</span>
<span class="n">XppSb2_Ipm</span>                    <span class="mi">0</span>        <span class="mi">120</span> <span class="n">Hz</span>    <span class="mi">40</span>                                 <span class="n">BldInfo</span><span class="p">(</span><span class="n">XppSb2_Ipm</span><span class="p">)</span>
<span class="n">XppSb3_Ipm</span>                    <span class="mi">0</span>        <span class="mi">120</span> <span class="n">Hz</span>    <span class="mi">40</span>                                 <span class="n">BldInfo</span><span class="p">(</span><span class="n">XppSb3_Ipm</span><span class="p">)</span>
<span class="n">cspad</span>                         <span class="mi">1</span>        <span class="mi">120</span> <span class="n">Hz</span>    <span class="mi">40</span>   <span class="n">Pos</span> <span class="mf">0.000549832</span>  <span class="mf">0.000010000</span>  <span class="n">DetInfo</span><span class="p">(</span><span class="n">XppGon</span><span class="o">.</span><span class="mi">0</span><span class="p">:</span><span class="n">Cspad</span><span class="o">.</span><span class="mi">0</span><span class="p">)</span>
<span class="n">yag2</span>                          <span class="mi">1</span>        <span class="mi">120</span> <span class="n">Hz</span>    <span class="mi">40</span>   <span class="n">Pos</span> <span class="mf">0.000690739</span>  <span class="mf">0.000300000</span>  <span class="n">DetInfo</span><span class="p">(</span><span class="n">XppSb3Pim</span><span class="o">.</span><span class="mi">1</span><span class="p">:</span><span class="n">Tm6740</span><span class="o">.</span><span class="mi">1</span><span class="p">)</span>
<span class="n">yag_lom</span>                       <span class="mi">1</span>        <span class="mi">120</span> <span class="n">Hz</span>    <span class="mi">40</span>   <span class="n">Pos</span> <span class="mf">0.000690739</span>  <span class="mf">0.000300000</span>  <span class="n">DetInfo</span><span class="p">(</span><span class="n">XppMonPim</span><span class="o">.</span><span class="mi">1</span><span class="p">:</span><span class="n">Tm6740</span><span class="o">.</span><span class="mi">1</span><span class="p">)</span>

<span class="gp">In [18]: </span><span class="n">ds</span><span class="o">.</span><span class="n">configData</span><span class="o">.</span><span class="n">Sources</span><span class="o">.</span><span class="n">cspad</span>
<span class="gh">Out[18]: </span><span class="go">&lt; SourceData: cspad = DetInfo(XppGon.0:Cspad.0) &gt;</span>

<span class="gp">In [19]: </span><span class="n">ds</span><span class="o">.</span><span class="n">configData</span><span class="o">.</span><span class="n">Sources</span><span class="o">.</span><span class="n">cspad</span><span class="o">.</span><span class="n">show_info</span><span class="p">()</span>
<span class="gh">Out[19]:</span>
<span class="go">evr_width               0.000010000 s   Evr trigger width</span>
<span class="go">group                             1     Evr group</span>
<span class="go">eventCode                        40     Evr event code</span>
<span class="go">src                    DetInfo(XppGon.0:Cspad.0)</span>
<span class="go">evr_delay               0.000549832 s   Evr trigger delay</span>
<span class="go">map_key                      (0, 3)     Evr configuation map key (card,channel)</span>
<span class="go">alias                         cspad</span>
<span class="go">evr_polarity                      0     Evr trigger polarity</span>

<span class="gp">In [20]: </span><span class="n">ds</span><span class="o">.</span><span class="n">configData</span><span class="o">.</span>
<span class="go">                        ds.configData.ControlData  ds.configData.keys         ds.configData.ScanData     ds.configData.Sources      ds.configData.XppSb3_Ipm</span>
<span class="go">                        ds.configData.cspad        ds.configData.Partition    ds.configData.show_all     ds.configData.XppEnds_Ipm0 ds.configData.yag2</span>
<span class="go">                        ds.configData.get          ds.configData.put          ds.configData.show_info    ds.configData.XppSb2_Ipm   ds.configData.yag_lom</span>
</pre></div>
</div>
<p>This information is gathered from the psana.env() configStore objection.  As with evt data, the configData object
makes the configStore keys, get and put methods avilable from the configStore object.</p>
<div class="section" id="detector-timing-and-config-check">
<h2>Detector Timing and Config Check<a class="headerlink" href="#detector-timing-and-config-check" title="Permalink to this headline">¶</a></h2>
<p>The detector timing and configuration can be checked against recommended operating values with
the checkConfig methods in configData object.</p>
<p>e.g., the recommended evr width for the 2.3M CsPad detectors is 0.1 ms.
In this example the width was set to 3 ms, and only a warning was issued
since this is generally not expected to cause an issue with the detector
readout.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [6]: </span><span class="n">ds</span> <span class="o">=</span> <span class="n">PyDataSource</span><span class="o">.</span><span class="n">DataSource</span><span class="p">(</span><span class="n">exp</span><span class="o">=</span><span class="s1">&#39;cxix34517&#39;</span><span class="p">,</span> <span class="n">run</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="gp">In [7]: </span><span class="n">ds</span><span class="o">.</span><span class="n">configData</span><span class="o">.</span><span class="n">configCheck</span><span class="o">.</span><span class="n">show_info</span><span class="p">()</span>
<span class="gh">Out[7]:</span>
<span class="go">detector        parameter      level    error</span>
<span class="gt">--------------------------------------------------------------</span>
<span class="n">DsdCsPad</span>        <span class="n">evr_width</span>      <span class="n">warning</span>  <span class="mf">0.003</span> <span class="o">&gt;</span> <span class="mf">0.0001</span>
</pre></div>
</div>
<p>The recommended detector timing settings from confluence:</p>
<ul class="simple">
<li><a class="reference external" href="https://confluence.slac.stanford.edu/x/kIWhBg">https://confluence.slac.stanford.edu/x/kIWhBg</a></li>
</ul>
<p>There are two files in json format.</p>
<p>One for the detector configdb information:</p>
<ul class="simple">
<li>/reg/g/psdm/utils/arp/config/default/config_alert.json</li>
</ul>
<p>And one for the evr trigger information:</p>
<ul class="simple">
<li>/reg/g/psdm/utils/arp/config/default/trigger_alert.json</li>
</ul>
<p>The structure is:</p>
<ul>
<li><p class="first">devName (.e.g., Cspad, Opal1000)</p>
<blockquote>
<div><ul>
<li><p class="first">alert/warning level (still tbd if emails or log posts are generated with alerts)</p>
<blockquote>
<div><ul>
<li><p class="first">attribute (e.g., evr_width, evr_polarity, evr_delay)</p>
<blockquote>
<div><ul class="simple">
<li>value:  either a single value or a list of the valid range [low, high]</li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
</ul>
<p>For example for the Cspad2x2 (i.e., 140k) detectors, a common readout issue
is setting the wrong polarity or delay.
The line in the default trigger_alert file is specified as</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;Cspad2x2&quot;</span>:<span class="o">{</span>
    <span class="s2">&quot;alert&quot;</span>:<span class="o">{</span><span class="s2">&quot;evr_polarity&quot;</span>:<span class="s2">&quot;Pos&quot;</span>,<span class="s2">&quot;evr_delay&quot;</span>:<span class="o">[</span><span class="m">0</span>.00048,0.00052<span class="o">]}</span>,
    <span class="s2">&quot;warning&quot;</span>:<span class="o">{</span><span class="s2">&quot;evr_width&quot;</span>:<span class="o">[</span><span class="m">0</span>.00001,0.0001<span class="o">]}</span>
    <span class="o">}</span>,
</pre></div>
</div>
<p>To make things more flexibile for each instrument to put in specific alerts
that may conflict with other instruments, there will be folders for each instrument.
The intent is that they generally will point to the default
unless instrument specific values are desired.  i.e.,</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ls /reg/g/psdm/utils/arp/config -l
total <span class="m">4</span>
lrwxrwxrwx <span class="m">1</span> koglin ps-pcds <span class="m">7</span> Apr <span class="m">19</span>  <span class="m">2018</span> amo -&gt; default
lrwxrwxrwx <span class="m">1</span> koglin ps-pcds <span class="m">7</span> Apr <span class="m">20</span>  <span class="m">2018</span> cxi -&gt; default
drwxrwsr-x <span class="m">2</span> koglin ps-pcds <span class="m">5</span> May <span class="m">18</span> <span class="m">12</span>:36 default
lrwxrwxrwx <span class="m">1</span> koglin ps-pcds <span class="m">7</span> Apr <span class="m">19</span>  <span class="m">2018</span> mec -&gt; default
lrwxrwxrwx <span class="m">1</span> koglin ps-pcds <span class="m">7</span> Apr <span class="m">19</span>  <span class="m">2018</span> mfx -&gt; default
lrwxrwxrwx <span class="m">1</span> koglin ps-pcds <span class="m">7</span> Apr <span class="m">19</span>  <span class="m">2018</span> sxr -&gt; default
lrwxrwxrwx <span class="m">1</span> koglin ps-pcds <span class="m">7</span> Apr <span class="m">19</span>  <span class="m">2018</span> xcs -&gt; default
lrwxrwxrwx <span class="m">1</span> koglin ps-pcds <span class="m">7</span> Apr <span class="m">19</span>  <span class="m">2018</span> xpp -&gt; default
</pre></div>
</div>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="reference internal" href="generated/PyDataSource.config_check.ConfigCheck.html#PyDataSource.config_check.ConfigCheck" title="PyDataSource.config_check.ConfigCheck"><code class="xref py py-obj docutils literal notranslate"><span class="pre">config_check.ConfigCheck</span></code></a>(configData[,&nbsp;…])</td>
<td>Check the detector config and trigger timing of PyDataSource.DataSource object.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="configdata-class-api">
<h2>ConfigData Class API<a class="headerlink" href="#configdata-class-api" title="Permalink to this headline">¶</a></h2>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="reference internal" href="generated/PyDataSource.ConfigData.html#PyDataSource.ConfigData" title="PyDataSource.ConfigData"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ConfigData</span></code></a>(ds)</td>
<td>Configuration Data representation of configStore within psana.DataSource.env object</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="attributes">
<h2>Attributes<a class="headerlink" href="#attributes" title="Permalink to this headline">¶</a></h2>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="reference internal" href="generated/PyDataSource.ConfigData.Sources.html#PyDataSource.ConfigData.Sources" title="PyDataSource.ConfigData.Sources"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ConfigData.Sources</span></code></a></td>
<td>Source information including evr config.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/PyDataSource.ConfigData.ScanData.html#PyDataSource.ConfigData.ScanData" title="PyDataSource.ConfigData.ScanData"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ConfigData.ScanData</span></code></a></td>
<td>Scan configuration from steps ControlData.</td>
</tr>
</tbody>
</table>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="generated/PyDataSource.config_check.ConfigCheck.html" class="btn btn-neutral float-right" title="PyDataSource.config_check.ConfigCheck" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="generated/PyDataSource.to_summary.html" class="btn btn-neutral" title="PyDataSource.to_summary" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, SLAC National Accelerator Laboratory.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.6.9',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>